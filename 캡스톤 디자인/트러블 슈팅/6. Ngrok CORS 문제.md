#ngork #cors
## 문제
- 프론트엔드와 백엔드간 연동 테스트를 위해 Ngrok을 사용했음
- ngrok의 visit site 문제 발생
- Spring boot의 CORSConfig와 security config에서 문제 발생

## ngork visit site 문제
- ngork에 접속하면 visit site로 들어가져서 로컬 spring boot로 들어오지 못하고 http status 200(OK)가 프론트측에서 나오는 문제 발생
- Ngrok의 보안 경고 페이지(HTML)가 200 OK로 반환되어, 프론트엔드가 백엔드 응답으로 착각함.

### 해결
- http header에 "ngrok-skip-browser-warning"을 CorsConfig 설정에 추가하여 해결
---
## AI답변
## Spring boot의 CORSConfig와 security config에서 문제 발생
- cors문제는 해결했는데, 프론트에서 요청을 보내면 정상적으로 토큰을 가지고 요청을 보냈음에도 403이 나오는 문제 발생

- **원인:** Security 필터가 `CorsConfig`를 인지하지 못했고, 인증 토큰이 없는 `Preflight(OPTIONS)` 요청을 막아서 발생.
    
## **해결 (수정됨):**
- **기존 작성:** ~~Security config에 cors bean을 추가하여 csrf설정을 추가하여 해결~~        
- **올바른 표현:** Security Config에 **`corsConfigurationSource`를 연결**하고, **`Preflight(OPTIONS)` 요청을 허용(`permitAll`)**하여 해결. _(참고: CSRF는 `disable`(비활성화) 했으므로 "설정을 추가"했다기보다 "껐다"는 표현이 맞으며, 403 에러의 직접적인 해결책은 CORS 연결이었습니다.)_



- **문제:** JWT 인증을 적용한 프로젝트에서 프론트엔드 연동 시, 토큰이 있음에도 `403 Forbidden`이 발생하는 CORS 문제 직면.
    
- **분석:** 브라우저의 `Preflight(OPTIONS)` 요청에는 토큰이 포함되지 않는데, Spring Security가 이를 '인증되지 않은 요청'으로 간주하여 차단함을 확인.
    
- **해결:** SecurityFilterChain 설정에 **`CorsConfigurationSource`를 명시적으로 연결**하고, **`OPTIONS` 메서드에 대한 접근을 `permitAll()`로 허용**하여 보안과 연동성을 모두 확보함.


## 403 에러가 Ngrok OPTIONS요청에서 났던 이유
- Preflight 요청(OPTIONS)요청은 빈 껍데기라서 토큰 없이 보냄
- 그런데 SecurityConfig는 로그인과 Swagger만 빼고 모두 토큰이 있어야 통과하게 설정해 놓아서 403
- 따라서 OPTIONS 요청은 무조건 통과시키게 설정을 바꿔줬음