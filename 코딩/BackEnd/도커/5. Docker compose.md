## Docker compose
- 여러 컨테이너를 한꺼번에 로컬에서 돌릴 수 있게 한다
- 쉽게 시작,종료
- YAML 파일에 서비스,네트워크,볼륨과 같은 애플리케이션의 설정을 할 수 있다
- 한개의 커맨드로 여러개의 컨테이너를 시작할 수 있다

## Docker compose key Feature
1. 다중 컨테이너 오케스트레이션
	1. 여러 개의 컨테이너를 하나의 어플리케이션처럼 관리하도록 만들어줌
	2. 예: 웹 어플리케이션과 DBMS를 한꺼번에 실행,관리
2. 선언적 환경설정(YAML)
	1. compose.yml 설정 파일을 사용해서 서비스,네트워크,저장소를 쉽게 정의하고 관리
3. 작업 단순화
	1. 명령어 한번으로 compose를 올리고 내릴수 있다
4. 서비스 독립적: copose안에 있는 개별 컨테이너를 독립적으로 실행,관리 가능
	1. `docker-compose.yml` 파일에서 웹 서버, 데이터베이스, 캐시 서버 등을 각각 별도의 서비스로 정의 가능.
	2. 각 서비스는 독립된 네트워크와 볼륨을 가질 수 있어 충돌 없이 실행됨.
	3. 예: `web` 서비스가 Nginx, `db` 서비스가 MySQL, `cache` 서비스가 Redis로 구성되어도 서로 독립적으로 실행되며 필요 시 네트워크로만 연결.
5. 이동성: 동일한 설정을 어디서든 재사용
	1. 보통 개발 단계에서 많이 사용하고 운영 환경에서는 K8S를 이용해 관리한다
6. 네트워킹: YAML파일 안의 여러개의 서비스(컨테이너)들끼리 연결을 할 수있다

## 사용 사례
1. 개발 환경-개발환경에서 여러개의 서비스를 한꺼번에 동기화해서 테스트를 해본다
2. 마이크로서비스-여러개의 서비스가 작게 시작되어 서로 연결되어 있음
3. 테스팅-한개의 YAML파일이 있으면 한꺼번에 시작이 되기 때문에 테스트하기 쉽다

### 장점
1. 여러개의 컨테이너간의 상호작용을 쉽게 만들어준다
2. 커맨드 입력을 최소화 할 수 있다
3. copose 자체의 버전 컨트롤을 지원한다

- **`docker compose stop`**: 컨테이너에게 종료 시그널을 보낸 후, 컨테이너가 작업을 완료하고 스스로 종료되도록 기다립니다 (Graceful Shutdown).
- **`docker compose kill`**: 즉시 컨테이너를 강제로 종료시킵니다. 작업 중인 데이터가 손실될 수 있으므로 최후의 수단으로 사용합니다.

## 예시
```yml
services:
  app: # Flask application service
    build:
      context: . # Use the Dockerfile in the current directory
    ports:
      - "5001:5000" # Map port 5000 on the host to port 5000 in the container
    depends_on:
      - db #db서비스를 먼저 시작하고 그 다음에 이 서비스를 시작한다
    environment: #app 서비스 내에서 사용하는 환경변수 설정/여기서 설정한 변수는 코드 영역에서 import하여 접근 할 수 있다
      - MYSQL_HOST=db
      - MYSQL_USER=root
      - MYSQL_PASSWORD=password
      - MYSQL_DATABASE=exampledb
  db: # MySQL database service
    image: mysql:8.0 # Use the official MySQL image
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: exampledb
    ports:
      - "3306:3306" # Map port 3306 on the host to port 3306 in the container
    volumes:
      - db_data:/var/lib/mysql #local volume인 db_data를 해당 디렉토리와 연결
        #/var/lib/mysql에 저장된 데이터는 모두 db_data에도 저장됨
    healthcheck: #advanced topic
      test: ["CMD", "mysqladmin", "ping", "--silent"]
      interval: 5s
      timeout: 10s
      retries: 3
volumes:
  db_data: # db_data라는 local volume이 생성된다
# if you see any issue, remove all the volumes
# docker-compose down --rmi all --volumes --remove-orphans
```
- docker compse up
- docker compse up --build
- `docker compose up` → 기존 이미지 있으면 그대로 사용 (빠름, 변경 사항 반영 안 될 수 있음).
- `docker compose up --build` → 항상 새로 빌드 후 실행 (변경 사항 반영 확실, 느릴 수 있음).