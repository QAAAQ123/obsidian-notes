## 스코프
- **스코프: 빈을 생성하고 관리하는 방식**
	- 싱글톤
		- 일반적인 싱글톤: 타입 하나당 하나의 인스턴스만 생성
		- 스프링의 싱글톤: 타입 하나당 여러개의 인스턴스를 생성 가능
	- 프로토타입
		- 빈을 생성하는 공장을 컨텍스트에 넣어두는 방식
		- 빈이 필요할 때마다 새로운 빈을 계속 만듦

## 싱글톤
인스턴스를 생성하고 유지하는 방식
- **@Bean이나 스테레오타입 어노테이션**을 통해 만드는 빈은 **싱글톤 타입**이다.
- 싱글톤 타입을 통해 만들어진 빈A는 반드시 같은 주소값을 가지고 있다.(여러 곳에서 빈A를 사용해도 빈A의 주소나 참조를 확인해보면 언제나 같다.)

### 실무 상황에서 싱글톤 빈 사용
- 실무 상황에서는 다중 스레드를 사용하는데, 이 상황에서 같은 싱글톤 빈의 인스턴스를 변경을 시도하면 경쟁 상태 시나리오가 발생한다.
- 경쟁 상태: 여러 스레드가 공유 자원을 변경하려고 할 때 발생
- 가장 좋은 해결 방법은 빈을 사용할때 final을 사용해 불변 상태로 만드는 것이다.(생성자 주입 방법)

### Bean 사용 방법
1. 프레임워크에서 제공되는 기능이 객체에 필요할 때
2. **~={red}stateful한 싱글톤 빈은 설계하면 안된다=~**.(싱글톤 빈은 항상 Stateless해야한다. Stateful한 빈은 나중에 나올 프로토타입을 사용한다.)
	1. Stateless: 내부에 객체의 상태를 저장하는 기능이 없는 상태
	2. Stateful: 내부에 객체의 상태를 저장하는 기능이 있는 상태(ex: 빈 사용 횟수 카운트)

### 즉시 및 지연 인스턴스 생성 방식
- **기본 생성 방식은 즉시 생성이다.**
- **지연 생성 방식을 사용하고 싶으면 @Bean이나 스테레오타입 어노테이션에 @Lazy를 추가해야 한다.**
- 지연 생성 방식: 빈을 처음 참조할 때 인스턴스 생성하는 방식
- 지연 방식 사용 시기
	1. 기능에 비해 너무 많은 빈이 컨텍스트에 들어가 있을 경우
	2. 문자 전송 기능을 수행하는 과정에서 통화,인터넷 연결,카메라... 등 목적에 부합하지 않는 빈들이 많을 때
- **지연 인스턴스 방식을 사용해야 한다는 것은 앱 설계에 문제가 있다는 신호 일 수 있다.**


## 프로토타입 
**~={red}빈에 대한 참조를 요청받을 때마다 새로운 인스턴스를 생성하는 방식(프레임워크에서 객체의 타입 관리)=~**
- 커피 나무에서 콩을 따는 과정과 비슷하다. 
- **여러 스레드에서 특정 프로토 타입 빈을 요청하면 각 스레드가 모두 다른 인스턴스를 얻는다.-> 경쟁 상태에 빠지지 않음**

### 프로토타입 빈 선언 방법
- @Bean이나 스테레오타입 어노테이션 아래에 @Scpoe 추가
```java
@Bean
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
//or
@Component
@Scope(BeanDefinition.SCOPE_PROTOTYPE)
```

### 프로토타입을 사용할 때 주의 사항
- ~={red}**프로토타입 자체를 싱글톤 빈에 직접 주입하면 안된다.**=~
- 싱글톤 빈에 프로토타입 자체를 넣으면, 인스턴스를 가지는게 아닌 프로토타입을 가지는 것이여서 결국 싱글톤 방식과 동일한 결과를 가져온다.
- 쉽게: 싱글톤 빈에 커피 콩(Bean)을 넣어야지 커피 나무(프로토타입)을 넣으면 안된다. 


## 싱글톤 프로토타입 비교
|싱글톤|프로토타입|
|-----|-----|
|1.이름이 실제 객체 인스턴스와 연관|1. 이름이 타입과 연관|
|2.~={red}빈을 참조할 때마나 동일한 인스턴스 얻음=~|2.~={red}빈을 참조할 때마다 새로운 인스턴스 얻음=~|
|3. 즉시,지연 생성 방식 선택 가능|3. 빈을 참조할때 항상 프로토타입 스코프에 대한 객체 생성|
|4. 스프링의 기본 빈 스코프|4. 명시적으로 표시해야 함|
|5. Stateless해야함|5. Stateful,Stateless 모두 가능|


## 요약
- 스코프: 객체 인스턴스 관리하는 방법
- 싱글톤,프로토타입 두가지 빈 스코프 제공
- 싱글톤은 즉시,지연 생성 방식 선택 가능
- 주로 싱글톤 빈 사용
- 변경 가능한 객체가 필요하면 프로토타입 스코프 사용
- 프로토타입의 빈을 싱글톤에 주입할 때는 조심해야한다. 싱글톤 인스턴스가 항상 같은 프로토타입 인스턴스를 얻기 때문이다. 