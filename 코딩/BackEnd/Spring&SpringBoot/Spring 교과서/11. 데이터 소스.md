## 데이터 소스란?
데이터 소스: 앱과 DBMS의 연결을 관리하는 객체
- 요청을 받으면 앱에 커넥션을 제공하고, 필요할 때만 새 커넥션을 만든다.
- 앱에서 데이터 소스 사용->데이터 소스가 JDBC드라이버를 사용하여 DBMS에 연결함
- 데이터 소스를 사용하여 DBMS를 연결하게 되면, 데이터의 영속성을 구현 할 수 있다.
- DB연결 반복작업을 하지 않아도 되게 만들어준다.(DriverManager.getConnection(xxx)계속 안해도 됨)
- 가장 많이 사용하는 구현체는 **HikariCP**이다. 

### JDBC(Java DataBase Connectivity)란?
- 앱이 특정 DBMS에 연결 하는 기능
- JDK(Java)는 특정 DBMS를 상세하게 구현하지 않는 대신 DBMS를 관리하는데 필요한 객체에 대한 추상화만 제공한다. 
- 추상화를 구현하고 DBMS에 연결할때 JDBC가 필요하다.
- Java나 Spring에서 제공하는 것이 아니고, DBMS공급 업체에서 DBMS에 맞는 JDBC 드라이버를 제공한다. ex)MySQL연결은 MySQL에서 제공한 JDBC를 사용한다.
- **~={red}결론: 앱에서 JDK로 추상화 된 데이터를 JDBC 드라이버에서 해당 DBMS에 맞게 구현하여 DBMS와 앱을 연결한다.=~**


## JdbcTemplate로 영속성 데이터 작업

단계
1. DBMS에 대한 커넥션 생성
2. 리포지터리 로직 작성
3. REST 엔드포인트의 동작을 구현하는 메소드(컨트롤러or서비스)에서 리포지터리 메소드 호출

~={red}*** ★★★부동 소수점을 정확하게 저장하고 연산할 때 소수점 정밀도를 잃지 않으려면 BigDecimal를 사용해야 한다★★★***=~

```java
@Repository
public class PurchaseRepository{
	private final JdbcTemplate jdbc;
	
	public PurchaseRepository(JdbcTemplate jdbc){this.jdbc = jdbc}
	
	public void storePurchase(Purchase purchase){
		String sql = "INSERT INTO purchase VALUES (NULL, ?, ?)";
		
		jdbc.update(sql,purchase.getProuct(),purchasegetPrice());
	}
}
```

## RowMapper
RowMapper: 데이터를 객체로 변환하는 방법을 JdbcTemplate에 알려주는 객체
```java
//@Repository안에 작성
RowMapper<Purchase> purchaseRowMapper = (r, i) -> {
	Purchase rowObject = new Purchase();
	rowObject.setId(r.getInt("id"));
	rowObject.setProduct(r.getString("product"));
	rowObject.setPrice(r.getBigDecimal("price"));
	return rowObject;
}
```

## 사용자 정의 데이터 소스(MySQL)
수행 단계
1. application.properties 파일에 **MySQL JDBC 드라이버를 추가**하고 데이터 소스 구성
2. application.properties에 정의한 데이터 소스를 기반으로 스프링 컨텍스트에 **DataSource 빈 정의**
3. 정의한 DataSource 빈을 사용

대부분 applicatoin.properties에 데이터 소스를 구성하면 정상적으로 동작한다. 하지만 가끔 DataSource 빈을 생성할때 스프링 부트에 의존을 할 수 없는 경우가 있다. 이때는 직접 구현을 해야한다

`@Value("xxx.xxx.xxx") private String url`이런식으로 작성하면 application.properties에 xxx.xxx.xxx=url이런식으로 작성하는 것과 같은 의미이다.
```java
//사용자 정의 데이터 소스 직접 구현
@Configuration
public class ProjectConfig{
	@Value("${custom.datasource.url}")
	private String datasourceUrl;
	
	@Value("${custom.datasource.username}")
	private String datasourceUsername;
	
	@Value("${custom.datasource.password}")
	private String datasourcePassword;
	
	@Bean
	public DataSource dataSource(){
		HikariDataSource dataSource = new HikariDataSource();
		
		dataSource.setJdbcUrl(datasourceUrl);
		dataSource.setUsername(datasourceUsername);
		dataSource.setPassword(datasourcePassword);
		dataSource.setConnectionTimeout(1000);
		
		return dataSource;
	}
}
```