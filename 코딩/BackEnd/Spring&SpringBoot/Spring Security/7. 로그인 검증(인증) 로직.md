![[spring security 작동 과정.png]]

- 인증을 진행하는 방법은 사용자가 Login 페이지를 통해 아이디, 비밀번호를 POST 요청시 spring security가 데이터베이스에 저장된 회원 정보를 조회 후 비밀번호를 검증하고 서버 세션 저장소에 해당 아이디에 대한 세션을 저장한다.

1. UserDetailsService를 상속받는 클래스 작성
2. 이 클래스 안에서 loadUserByUsername(String username) 메소드 override(여기서 매개변수 username은 클라이언트에서 받아온 것임)
```java
@Service  
public class CustomUserDetailsService implements UserDetailsService {  
  
    @Autowired  
    private UserRepository userRepository;  
  
    //DB에서 가져온 데이터와 클라이언트에서 받아온 데이터 검증하는 로직 override    @Override  
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {  
        //매개변수의 username-> 클라이언트에서 받아온 username        UserEntity userData = userRepository.findByUsername(username);  
  
        if(userData != null){  
            //CustomUserDetails 클래스 -> 받아온 username을 통해 만든 userDate를 security config에  
            //넘겨주어서 각종 검증을 한뒤 세션에 데이터를 저장하는 클래스  
            return new CustomUserDetails(userData);  
        }  
  
        return null;  
    }
```
3. loadUserByUsername(String username)안에서 security config를 통해 비밀번호,이름,역할을 검증하는 클래스 작성해야함
4. CustomUserDetails 클래스는 UserDetails를 implements하여 작성한다. 모든 구현이 안된 메소드들을 Override하여 상황에 맞게 작성해주면 된다.(==CustomUserDetails 클래스는 DTO이다.==)
```java
public class CustomUserDetails implements UserDetails {  
  
    private UserEntity userEntity;  
  
    public CustomUserDetails(UserEntity userEntity){  
        this.userEntity = userEntity;  
    }  
  
    //사용자의 role값 return    @Override  
    public Collection<? extends GrantedAuthority> getAuthorities() {  
  
        Collection<GrantedAuthority> collection = new ArrayList<>();  
  
        collection.add(new GrantedAuthority() {  
            @Override  
            public String getAuthority() {  
                return userEntity.getRole();  
            }  
        });  
  
        return collection;  
    }  
  
    @Override  
    public String getPassword() {  
        return userEntity.getPassword();  
    }  
  
    @Override  
    public String getUsername() {  
        return userEntity.getUsername();  
    }  
  
    //아래의 메소드들은 userEntity에서 설정해주지 않았기 때문에  
    //완료가 되지 않았다라고 전달해주는 리턴 값을 true로 설정한다.  
    @Override  
    public boolean isAccountNonExpired() {  
        return true;  
    }  
  
    @Override  
    public boolean isAccountNonLocked() {  
        return true;  
    }  
  
    @Override  
    public boolean isCredentialsNonExpired() {  
        return true;  
    }  
  
    @Override  
    public boolean isEnabled() {  
        return true;  
    }  
}
```