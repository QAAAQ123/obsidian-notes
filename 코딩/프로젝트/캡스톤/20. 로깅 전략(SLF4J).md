#로깅 #개념
## 1. 로깅 레벨
SLF4J 레벨
- **TRACE (추적)**
    - **의미:** DEBUG보다 훨씬 더 상세한 정보.
    - **용도:** 루프(Loop) 내부의 변수 변화나, 아주 복잡한 알고리즘의 단계별 이동을 추적할 때 사용합니다.
    - **전략:** 개발 서버에서도 잘 켜지 않으며, 로컬 디버깅 시 일시적으로만 사용합니다.
- **DEBUG (디버깅)**
    - **의미:** 시스템 흐름 파악을 위한 정보.
    - **용도:** SQL 실행 문장, 파라미터로 넘어온 값, 내부 로직의 분기 처리 등을 확인합니다.
    - **전략:** **개발 서버(Dev)**의 기본 레벨입니다. 운영 서버에서는 성능 저하 및 로그 용량 폭주를 막기 위해 꺼두는 것이 일반적입니다.
- **INFO (정보)**
    - **의미:** 명확한 의도를 가진 비즈니스 이벤트.
    - **용도:** "사용자 로그인 성공", "회원가입 완료", "결제 승인" 등 시스템의 주요 상태 변화나 성공 케이스를 기록합니다.
    - **전략:** **운영 서버(Prod)**의 기본 레벨입니다. 운영자가 시스템이 정상적으로 돌아가고 있는지 모니터링하는 지표가 됩니다.
- **WARN (경고)**
    - **의미:** 에러는 아니지만, 잠재적인 문제가 있거나 주의가 필요한 상황.
    - **용도:** "사용자가 틀린 비밀번호 입력(보안 이슈)", "외부 API 호출 지연(타임아웃 임박)", "Deprecated된 함수 사용" 등.
    - **전략:** 시스템은 멈추지 않지만, 개발자가 추후 확인하여 개선해야 할 포인트입니다.
- **ERROR (오류)**
    - **의미:** 요청 처리 실패, 시스템 장애.
    - **용도:** `Exception` 발생, DB 연결 실패, 필수 데이터 누락 등 즉각적인 조치가 필요한 심각한 문제.
    - **전략:** 반드시 알람(Slack, Email)과 연동하여 개발자가 즉시 인지하도록 해야 합니다. Stack Trace(에러 발생 위치 추적 정보)를 남겨야 합니다.

## 2. 로깅 전략

좋은 로그는 **'문맥(Context)'**을 담고 있어야 합니다. 단순히 "에러 발생"이라고 남기는 것은 무의미합니다.
#### A. 5W1H 원칙 적용
로그 메시지 하나만 보고도 상황을 파악할 수 있어야 합니다.
- **Who (누가):** 사용자 ID, 이메일, 클라이언트 IP
- **When (언제):** 타임스탬프 (자동 기록됨).
- **Where (어디서):** 어떤 컨트롤러, 서비스, 메서드에서 발생했는지.
- **What (무엇을):** 수행한 작업 (예: 프로필 수정, 찜하기 삭제).
- **Why (왜):** (에러 시) 실패 원인, 입력된 잘못된 값.
- **How (어떻게):** 어떤 파라미터를 가지고 로직을 수행했는지.
#### B. 요청 추적 (Correlation ID / Request ID)
스프링 부트와 같은 멀티 스레드 환경에서는 여러 사용자의 로그가 뒤섞입니다.
- **개념:** HTTP 요청이 들어올 때 고유한 ID(UUID 등)를 발급하여, 해당 요청이 끝날 때까지 모든 로그에 이 ID를 함께 찍는 방식입니다.
- **효과:** `grep` 명령어나 로그 시스템에서 해당 ID만 검색하면, 특정 유저의 한 번의 요청 흐름을 처음부터 끝까지 이어 볼 수 있습니다. MDC(Mapped Diagnostic Context) 패턴을 주로 사용합니다.

#### C. 예외 처리 전략 (Exception Handling)
- **Full Stack Trace:** ERROR 레벨에서는 에러의 시작점부터 끝까지 모든 경로(Stack Trace)를 남겨야 디버깅이 가능합니다.
- **지양해야 할 패턴:** 예외를 `catch`만 하고 로그를 남기지 않는 것(Swallowing)은 최악의 안티 패턴입니다.


## 3. 로깅 디자인

현대적인 백엔드 환경(MSA, 클라우드)에서는 사람이 텍스트 파일을 열어보는 것이 아니라, ELK(Elasticsearch, Logstash, Kibana) 같은 로그 수집 시스템이 로그를 분석합니다.

#### A. 구조화된 로깅 (Structured Logging) - JSON
- **텍스트 로그:** `[INFO] User joined email=test@test.com` (사람이 읽기 좋음, 기계 파싱 어려움)
- **JSON 로그:** `{"level": "INFO", "message": "User joined", "userId": "test@test.com", "timestamp": "..."}`
- **장점:** 로그 시스템에서 필드별로 검색, 필터링, 통계(예: 시간당 가입자 수)를 내기 매우 유리합니다.

#### B. PII (개인식별정보) 마스킹 (Security)
- `Member` 도메인은 특히 주의해야 합니다.
- **절대 남기면 안 되는 것:** 비밀번호, 주민등록번호, 카드 번호 등.
- **마스킹 필요:** 이메일(`te**@test.com`), 전화번호 등 민감할 수 있는 정보는 일부 가림 처리(Masking) 후 로그에 남겨야 보안 사고를 예방할 수 있습니다.