[링크](https://curiousjinan.tistory.com/entry/spring-filterchain-dofilter#1.%20doFilter%20%EB%A9%94%EC%84%9C%EB%93%9C%20%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-1)
#filter 
## Filter chain
서블릿 컨테이너가 관리하는 필터의 연결 고리로, 클라이언트 요청이 서블릿에 도달하기 전에 여러 필터를 순차적으로 거치게 하는 메커니즘


### 1. Java의 체이닝 설정
- web.xml파일로 필터 등록하는 순서에따라 실행 순서 결정
- web.xml에서는 `filter-mapping` 태그의 순서에 따라 필터의 실행 순서가 결정된다.

### 2. Spring 체이닝 설정
- 필터를 등록하는 순서에 따라 결정
- @WebFilter 어노테이션이나 WebApplicationInitializer인터페이스 구현

#### 2.1 WebApplicationInitizer인터페이스 구현방식
- 서블릿 컨테이너가 시작될 때 필요한 설정을 java코드로 직접 작성 가능
-  addFilter() 메서드를 사용하여 필터를 등록하고 있고, addMappingForUrlPatterns() 메서드는 필터가 적용될 URL 패턴을 지정한다. 필터 등록 순서에 따라 필터 체이닝 순서가 결정된다.

#### 2.2 @WebFilter 어노테이션 사용 방식
- 필터 클래스에 직접 적용되며, 필터의 이름과 URL 패턴을 지정할 수 있다. 하지만, 스프링 프레임워크에서는 **@Order** 어노테이션 같은 것으로 필터의 순서를 지정할 수 없다.
- 만약 필터의 순서를 지정하고 싶다면, 위에서 사용한 WebApplicationInitializer를 사용하여 필터 등록 순서를 직접 관리해야 한다. @WebFilter 어노테이션으로 등록된 필터는 서블릿 컨테이너가 자동으로 인식하지만, 순서를 지정하려면 WebApplicationInitializer에서 필터를 등록하고 순서를 명시적으로 지정해야 한다는 점을 명심해야 한다.

### 3. Spring boot의 FilterChain과 체이닝

#### 3.1 Spring Boot 필터 체이닝 개념
- 자동 구성과 자바 기반 설정
- @SpringBootApplication으로 자동 구성 활성화하고 내부적으로 @EnableAutoConfiguration을 포함한다

#### 3.2 Spring boot 체이닝 설정
- FilterRegistrationBean을 사용하여 필터 등록,순서 정의
- setOrder메서드로 명시적 순서 지정

#### 3.3 체이닝
- Spring과 동일하게 doFilter 메서드 내의 `chain.doFilter(request,response)`를 쓴다
- ~={red}**OncePerRequestFilter=~를 쓰면, 요청당 한번만 실행되도록 필터 제어 가능**->JWT인층 필터를 만들 때 사용
	- OncePerRequestFilter를 상속받은 필터는 한번만 작동하고, 두번째 요청부터는 skip한다.
	- 예시) /login요청->A: Filter,B: OncePerRequestFilter(JWT검사)
		- /login 요청: A -> B(JWT검사) -> /welcom으로 Forward
		- /welcome 요청: A -> B(JWT검사)는 이미 했으니 스킵함 -> 서블릿 도착 -> welcome화면 보여줌