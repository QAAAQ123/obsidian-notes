#LastModifiedDate
### **`@LastModifiedDate` 동작 분석**

`lastMessageAt`에 `@LastModifiedDate`를 붙였을 때의 동작은 다음과 같습니다.

#### **동작 원리**

- **자동 업데이트:** 해당 필드는 **`ChatSession` 문서 전체가 DB에 저장(save)되거나 수정될 때마다** Spring Data MongoDB가 현재 시간으로 자동으로 갈아 끼워줍니다.    
- **메시지 추가 시:** 메시지를 추가하는 행위 자체가 `ChatSession` 내의 `messages` 리스트를 수정하고 전체를 다시 저장(`repository.save(session)`)하는 과정이므로, **메시지가 추가될 때마다 시간이 갱신**되는 효과를 얻을 수 있습니다.


#### **⚠️ 주의사항: `MongoTemplate` 사용 시**

만약 성능 최적화를 위해 `MongoTemplate`의 `.push()` 기능을 사용하여 **부분 업데이트**를 수행한다면, Spring Data의 **Auditing(`@LastModifiedDate`) 기능이 동작하지 않을 수 있습니다.**

- **이유:** Auditing은 엔티티 객체가 영속성 컨텍스트를 거칠 때 발생하는데, `MongoTemplate`의 직접 쿼리는 이 과정을 생략하는 경우가 많기 때문입니다.
- **추천:** 채팅 앱처럼 실시간성이 중요한 경우, 메시지를 추가하는 비즈니스 로직 안에서 **`session.setLastMessageAt(LocalDateTime.now())`를 명시적으로 호출**해주는 것이 가장 확실하고 예측 가능한 방법입니다.