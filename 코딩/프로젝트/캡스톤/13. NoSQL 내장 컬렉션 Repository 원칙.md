#NoSQL #내장컬렉션 #Repository #MongoTemplate
## NoSQL 내장 컬렉션 패턴 원칙
"Repository는 애그리거트 루트(Aggregate Root)에 대해서만 만든다."


### 애그리거트 루트
- **주인(Aggregate Root):** `ChatSession` (문서 ID가 있고, 독립적으로 존재함)
- **부품(Embedded):** `Chat` (세션 없이는 존재 의미가 없음, ID가 있어도 식별 용도일 뿐 독립 조회 안 함)

## 코드 구조
- 내장 컬렉션에는 @Document를 붙히지 않고 단순 내장 클래스를 만든다

## 내장 데이터 저장/수정 방법
1. 조회 후 전체 저장(트래픽 적을 때)
	1. Java 메서드안에서 부모를 불러온다
	2. 부모에 add하고 부모를 통채로 save한다
2. MongoTemplate 사용
	1. MongoRepository대신에 MongoTemplate를 사용한다.
	2. 내장 컬렉션만 수정해서 훨씬 빠르다. 