```python
import streamlit as st  
import google.generativeai as genai  
import requests  
from bs4 import BeautifulSoup  
  
# ==========================================  
# 1. API í‚¤ ì…ë ¥  
# ==========================================  
GOOGLE_API_KEY = ""  
genai.configure(api_key=GOOGLE_API_KEY)  
  
# ==========================================  
# 2. ì„¤ì •  
# ==========================================  
SEC_HEADERS = {  
    'User-Agent': 'MvpTester (test@example.com)',  
    'Accept-Encoding': 'gzip, deflate'  
}  
  
  
def get_best_available_model():  
    """  
    [í•µì‹¬ ìˆ˜ì •]  
    ë‚´ ê³„ì •ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ ëª©ë¡ì„ ì¡°íšŒí•´ì„œ  
    ê°€ì¥ ì í•©í•œ ëª¨ë¸ ì´ë¦„ì„ ìë™ìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.  
    """    try:  
        available_models = []  
        for m in genai.list_models():  
            if 'generateContent' in m.supported_generation_methods:  
                available_models.append(m.name)  
  
        # ë””ë²„ê¹…: í™”ë©´ì— ëª©ë¡ì„ ì¶œë ¥í•´ì„œ í™•ì¸ ê°€ëŠ¥í•˜ê²Œ í•¨  
        print(f"ë‚´ ê³„ì • ì‚¬ìš© ê°€ëŠ¥ ëª¨ë¸: {available_models}")  
  
        # 1ìˆœìœ„: Flash ëª¨ë¸ (ì†ë„/ë¹„ìš© ìµœì )  
        for model in available_models:  
            if 'flash' in model.lower():  
                return model  # ì˜ˆ: models/gemini-1.5-flash-latest  
  
        # 2ìˆœìœ„: Pro ëª¨ë¸ (ì°¨ì„ ì±…)  
        for model in available_models:  
            if 'pro' in model.lower():  
                return model  
  
        # 3ìˆœìœ„: ì•„ë¬´ê±°ë‚˜ ì²« ë²ˆì§¸  
        return available_models[0] if available_models else None  
  
    except Exception as e:  
        return None  
  
  
def get_gemini_summary(text):  
    # ìë™ìœ¼ë¡œ ìµœì  ëª¨ë¸ ì°¾ê¸°  
    model_name = get_best_available_model()  
  
    if not model_name:  
        return "ì‚¬ìš© ê°€ëŠ¥í•œ AI ëª¨ë¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. API í‚¤ ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”."  
  
    # ëª¨ë¸ ìƒì„±  
    model = genai.GenerativeModel(model_name)  
  
    prompt = f"""  
    ë„ˆëŠ” ì›”ê°€ ìµœê³ ì˜ í—¤ì§€í€ë“œ ë§¤ë‹ˆì €ì•¼.  
  
    ì•„ë˜ í…ìŠ¤íŠ¸ëŠ” êµ¬ê¸€(Alphabet)ì˜ 10-K(ì—°ì°¨ë³´ê³ ì„œ) í…ìŠ¤íŠ¸ì•¼.  
    ì´ ì¤‘ì—ì„œ **"Item 1A. Risk Factors"** ë‚´ìš©ì„ ì°¾ì•„ì„œ ë¶„ì„í•´.  
  
    [ë¶„ì„ ìš”êµ¬ì‚¬í•­]  
    1. ì¼ë°˜ì ì¸ ë‚´ìš© ë§ê³ , êµ¬ê¸€ë§Œì˜ **êµ¬ì²´ì  ë¦¬ìŠ¤í¬(ë°˜ë…ì  ì†Œì†¡, AI ê²½ìŸ ë“±) 3ê°€ì§€**ë¥¼ ë½‘ì•„.  
    2. ê° ë¦¬ìŠ¤í¬ì˜ ê·¼ê±°ê°€ ë˜ëŠ” ë¬¸ì¥ì„ ì°¾ì•„ì„œ ì¸ìš©í•´.  
    3. í•œêµ­ì–´ë¡œ ì‰½ê³  ëª…í™•í•˜ê²Œ ì‘ì„±í•´.  
  
    [ë¬¸ì„œ ë‚´ìš© (ì•ë¶€ë¶„ 10ë§Œ ì ë°œì·Œ)]  
    {text}   
"""  
  
    try:  
        response = model.generate_content(prompt)  
        return response.text + f"\n\n(âœ… ë¶„ì„ì— ì‚¬ìš©ëœ ëª¨ë¸: `{model_name}`)"  
    except Exception as e:  
        return f"AI í˜¸ì¶œ ì¤‘ ì—ëŸ¬ ({model_name}): {str(e)}"  
  
  
def get_google_risk_direct():  
    cik_str = "0001652044"  
  
    try:  
        # ë©”íƒ€ë°ì´í„° ê°€ì ¸ì˜¤ê¸°  
        json_url = f"https://data.sec.gov/submissions/CIK{cik_str}.json"  
        resp = requests.get(json_url, headers=SEC_HEADERS, timeout=10)  
        data = resp.json()  
  
        # 10-K ì°¾ê¸°  
        forms = data['filings']['recent']['form']  
        accession_numbers = data['filings']['recent']['accessionNumber']  
        primary_documents = data['filings']['recent']['primaryDocument']  
  
        found_index = -1  
        for i, form_name in enumerate(forms):  
            if form_name == '10-K':  
                found_index = i  
                break  
  
        if found_index == -1: return None, "10-K ì—†ìŒ"  
  
        # URL ì¡°ë¦½  
        cik_int = int(cik_str)  
        acc_num_clean = accession_numbers[found_index].replace('-', '')  
        doc_name = primary_documents[found_index]  
        html_url = f"https://www.sec.gov/Archives/edgar/data/{cik_int}/{acc_num_clean}/{doc_name}"  
  
        # ë‹¤ìš´ë¡œë“œ  
        doc_resp = requests.get(html_url, headers=SEC_HEADERS, timeout=20)  
        soup = BeautifulSoup(doc_resp.content, 'html.parser')  
        full_text = soup.get_text()  
  
        # [ìš”ì²­í•˜ì‹  ìœ ì§€ ì‚¬í•­]  
        # í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¸¸ë©´(20ë§Œ ì ì´ìƒ) ë¬´ë£Œ í† í° í•œë„ ì´ˆê³¼ ë° ì—ëŸ¬ ë°œìƒ.  
        # Risk FactorsëŠ” ì•ìª½ì— ìˆìœ¼ë¯€ë¡œ, ë’¤ìª½ì„ ì˜ë¼ë‚´ê³  ì•ë¶€ë¶„ 10ë§Œ ìë§Œ ì‚¬ìš©.  
        optimized_text = full_text[:100000]  
  
        return optimized_text, None  
  
    except Exception as e:  
        return None, f"ì‹œìŠ¤í…œ ì—ëŸ¬: {str(e)}"  
  
  
# ==========================================  
# 3. í™”ë©´ UI# ==========================================  
st.title("êµ¬ê¸€(Alphabet) ë¦¬ìŠ¤í¬ ë¶„ì„ê¸° ğŸ§ ")  
  
if st.button("ë¶„ì„ ì‹œì‘"):  
    if GOOGLE_API_KEY.startswith("ì—¬ê¸°ì—"):  
        st.error("API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!")  
    else:  
        with st.spinner("ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì²˜ë¦¬ ì¤‘..."):  
            text_data, error = get_google_risk_direct()  
  
            if error:  
                st.error(error)  
            else:  
                st.success(f"ë°ì´í„° ì „ì²˜ë¦¬ ì™„ë£Œ! (ì•ë¶€ë¶„ {len(text_data)}ì ì¶”ì¶œ)")  
  
                with st.spinner("AI ëª¨ë¸ì„ ê°ì§€í•˜ê³  ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."):  
                    summary = get_gemini_summary(text_data)  
                    st.divider()  
                    st.markdown(summary)
```